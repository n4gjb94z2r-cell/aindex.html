document.getElementById("startBtn").onclick = () => {
    const url = document.getElementById("webhookUrl").value.trim();
    const message = document.getElementById("message").value.trim();
    let count = parseInt(document.getElementById("count").value);
    let intervalSec = parseFloat(document.getElementById("interval").value);

    if (!url || !message) {
        alert("Webhook URLとメッセージは必須です。");
        return;
    }

    if (intervalSec < 1) intervalSec = 1;
    intervalSec = intervalSec * 1000;

    sentCount = 0;
    updateStatus();

    intervalId = setInterval(() => {
        fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ content: message })
        }).then(res => console.log("送信成功:", res.status))
          .catch(err => console.error("送信失敗:", err));

        sentCount++;
        updateStatus();

        if (count > 0 && sentCount >= count) {
            clearInterval(intervalId);
            document.getElementById("status").textContent = `送信完了: ${sentCount}回`;
        }
    }, intervalSec);
};
